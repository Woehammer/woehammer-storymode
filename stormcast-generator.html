<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stormcast Eternals â€“ Story Mode Generator</title>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:16px;background:#fff}
    .wrap{max-width:980px;margin:0 auto;border:1px solid #ddd;border-radius:12px;padding:16px;background:#fff}
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .card{border:1px solid #e6e6e6;border-radius:12px;padding:12px;background:#fafafa;flex:1;min-width:260px}
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
    button{padding:10px 12px;border-radius:10px;border:1px solid #ccc;background:#f3f3f3;font-weight:800;cursor:pointer}
    button.primary{background:#1976d2;border-color:#1976d2;color:#fff}
    button.danger{background:#fff;border-color:#d32f2f;color:#d32f2f}
    h3{margin:0 0 6px 0}
    .muted{color:#777;font-size:12px}
    .kv{margin:0;font-size:14px;line-height:1.4}
    .kv b{display:inline-block;min-width:110px}

    .output{margin:0;padding:16px;background:#fff;border-radius:12px;min-height:220px;border:1px solid #ddd;line-height:1.55}
    .output p{margin:0 0 10px 0}
    .output strong{font-weight:700}

    .section{margin:14px 0 10px 0;padding-top:12px;border-top:1px solid #e9e9e9}
    .section-title{font-size:13px;letter-spacing:.06em;text-transform:uppercase;color:#666;font-weight:800;margin-bottom:6px;display:flex;align-items:center;gap:8px}

    .log-header{display:flex;align-items:center;gap:10px;margin:12px 0 6px 0}
    .log-icon{width:34px;height:34px;border-radius:10px;border:1px solid #e1e1e1;background:#f7f7f7;display:flex;align-items:center;justify-content:center;font-size:18px}

    .help{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:999px;border:1px solid #d0d0d0;background:#f7f7f7;color:#555;font-weight:900;font-size:12px;line-height:1;cursor:help;position:relative;user-select:none;flex:0 0 auto}
    .help:focus{outline:2px solid #1976d2;outline-offset:2px}
    .help .tip{display:none;position:absolute;z-index:50;left:50%;transform:translateX(-50%);top:24px;width:min(320px,80vw);background:#111;color:#fff;border-radius:10px;padding:10px 12px;font-size:12px;font-weight:600;box-shadow:0 8px 20px rgba(0,0,0,.2)}
    .help .tip::before{content:"";position:absolute;top:-6px;left:50%;transform:translateX(-50%);border-width:0 6px 6px 6px;border-style:solid;border-color:transparent transparent #111 transparent}
    .help:hover .tip,.help:focus .tip{display:block}
  </style>
</head>

<body>
<div class="wrap" id="storymode-stormcast">

  <h3>Stormcast Eternals â€“ Story Mode Generator</h3>
  <p class="muted">Optional narrative aide. No rules impact. Saved locally in your browser.</p>

  <div class="row" style="margin-top:12px;">
    <div class="card">
      <h3 style="font-size:16px;">Current Character</h3>
      <p class="kv"><b>Realm:</b> <span id="cur-realm">â€”</span></p>
      <p class="kv"><b>General:</b> <span id="cur-general">â€”</span></p>
      <p class="kv"><b>Background:</b> <span id="cur-bg">â€”</span></p>

      <p class="kv">
        <b>Mission:</b> <span id="cur-mission">â€”</span>
        <span class="help" tabindex="0" aria-label="What is Mission?">?
          <span class="tip"><b>Mission</b> is the battle type for this chapter (Incursion, Pursuit, Escalation, Revelation). Roll <b>Battle Hook</b> to get different blurbs for the same Mission.</span>
        </span>
      </p>

      <div class="btns">
        <button id="btn-reset" class="danger" type="button">Reset Character</button>
      </div>
    </div>

    <div class="card">
      <h3 style="font-size:16px;">Actions</h3>
      <div class="btns">
        <button id="btn-all" class="primary" type="button">Generate Full Starter</button>
        <button id="btn-general" type="button">Roll General</button>
        <button id="btn-mission" type="button">Roll Mission</button>
        <button id="btn-hook" type="button">Roll Battle Hook</button>
        <button id="btn-interlude" type="button">Roll Interlude</button>
        <button id="btn-copy" type="button">Copy</button>
      </div>
      <p class="muted">Roll Mission once, then reroll Battle Hook as many times as you like for different blurbs.</p>
    </div>
  </div>

  <div class="log-header">
    <div class="log-icon">ðŸ“œ</div>
    <h3>Campaign Log</h3>
  </div>

  <div id="out" class="output">
    <p class="muted">Ready. Click <strong>Generate Full Starter</strong>.</p>
  </div>

</div>

<script>
(function(){
  const STORAGE = "woehammer_stormcast_story_v7";
  const pick = a => a[Math.floor(Math.random()*a.length)];
  const roll = n => Math.floor(Math.random()*n)+1;

  let state = {};
  try { state = JSON.parse(localStorage.getItem(STORAGE) || "{}"); }
  catch { state = {}; }

  const save = () => localStorage.setItem(STORAGE, JSON.stringify(state));
  const clear = () => localStorage.removeItem(STORAGE);

  const realms = ["Aqshy","Ghyran","Shyish","Ghur","Chamon","Ulgu"];

  const firstNames = ["Aster","Lyra","Kaelis","Brannic","Seraphine","Garran","Odrin","Merek","Siora","Eamon","Vexan","Thane"];
  const lastNames  = ["Valorn","Dawnward","Stormvein","Goldsign","Halospear","Ironlight","Truthbrand","Ashward","Skywrath","Steelward","Windstride","Brightfall"];

  const backgrounds = [
    {k:"reforged",l:"Many-Times Reforged (Memories Fraying)"},
    {k:"new",l:"Freshly Forged (New to Immortality)"},
    {k:"redeemer",l:"Redeemer (Oath to Protect the Helpless)"},
    {k:"slayer",l:"Slayer (Hunts a Specific Foe)"},
    {k:"prophet",l:"Vision-Bound (Dreams and Portents)"},
    {k:"judge",l:"Celestial Judge (No Mercy for Corruption)"}
  ];

  const missionTypes = ["Incursion","Pursuit","Escalation","Revelation"];

  // Multiple blurbs PER mission type (add more anytime)
  const battleHooks = {
    Incursion:[
      "A sudden assault strikes an area you previously thought secure. You must muster quickly, march your force, and drive the attackers back before they slip away with whatever they came for.",
      "Raiders appear from hidden routes at dusk, striking supply wagons and outposts. If you donâ€™t respond immediately, your campaign will starve before it truly begins.",
      "Enemy scouts and light troops push into your territory, testing your response. Break them now or theyâ€™ll map every weakness you have.",
      "A night attack hits your outer pickets. The alarm goes up too late to prevent damage â€” but not too late for vengeance. You must push the enemy from your doorstep.",
      "A false signal draws your patrols away, then the real blow falls. The enemy wants something specific. You canâ€™t let them leave with it."
    ],
    Pursuit:[
      "The enemy is falling back, wounded but dangerous. You can let them escape and regroupâ€¦ or you can chase them down and finish the fight on your terms.",
      "A rearguard buys time with brutal efficiency. Every mile you gain costs blood â€” but if you relent, the enemy will be gone by morning.",
      "You catch glimpses of fleeing banners through smoke and rain. If you can force a battle before they reach safety, you might end this quickly.",
      "Tracks and broken standards mark the route of retreat. Your scouts insist the enemy is close. Push hard now, or the trail goes cold.",
      "Your strike broke their line â€” but not their will. The enemy runs toward cover. If you can cut them off, you can turn a victory into a rout."
    ],
    Escalation:[
      "The conflict widens and restraint dies. Reinforcements arrive, strongpoints are seized, and the war becomes impossible to ignore. This battle will shape the next phase of the campaign.",
      "Positions harden into front lines. Both sides commit fully â€” supplies, morale, and reputations are on the line, and neutrality is no longer an option.",
      "What began as skirmishes becomes open warfare. Strike hard now, or youâ€™ll be fighting a stronger enemy later.",
      "The enemy has fortified a key position overnight. If you donâ€™t break it now, the campaign will stall and your allies will lose faith.",
      "Rumours spread through nearby settlements: this war is here to stay. A decisive battle is needed â€” something that convinces everyone who holds the ground."
    ],
    Revelation:[
      "Victory uncovers something you werenâ€™t meant to find â€” a truth, a relic, or a betrayal. Now you must fight not just to win, but to control who learns what.",
      "Evidence suggests the enemy was never acting alone. Your next battle isnâ€™t just against soldiers â€” itâ€™s against the hidden hand guiding them.",
      "A pattern becomes undeniable. The war is part of something older and darker than you knew, and this engagement may decide what comes next.",
      "A captured foe speaks a name you recognise â€” but you donâ€™t know why. The battle ahead may reveal what reforging has stolen from you.",
      "You find signs of a ritual site, abandoned in haste. The enemy is racing to finish what they started. You must stop them before the truth becomes catastrophe."
    ]
  };

  const interludes = {
    base:[
      "Mortals look to you as a myth made real â€” and expect miracles.",
      "Orders from Azyr conflict with reality on the ground.",
      "A memory surfaces that should not exist."
    ],
    reforged:["You forget a name that once mattered more than victory."],
    new:["Immortality settles in â€” heavier than expected."],
    redeemer:["A plea for protection arrives at the worst possible moment."],
    slayer:["You glimpse a sign that your quarry is close â€” and it makes you reckless."],
    judge:["Corruption is found among allies. Justice will fracture trust."],
    prophet:["A dream leaves you certain of the next battlefieldâ€¦ and afraid of it."]
  };

  function ensureRealm(){
    if(!state.realm){ state.realm = pick(realms); save(); }
  }

  function rollGeneral(){
    const bg = pick(backgrounds);
    state.general = {
      name: `${pick(firstNames)} ${pick(lastNames)}`,
      bgKey: bg.k,
      bgLabel: bg.l
    };
    save();
  }

  function rollMission(){
    const t = pick(missionTypes);
    state.missionType = t;
    save();
    return t;
  }

  // Roll a blurb for the CURRENT mission type (does not change mission type)
  function rollBattleHookForCurrentMission(){
    const t = state.missionType || rollMission();
    const hook = pick(battleHooks[t] || ["(No hooks defined yet for this mission type.)"]);
    state.lastHook = { type: t, text: hook };
    save();
    return state.lastHook;
  }

  function threat(){
    const r = roll(6)+roll(6);
    if(r<=3) return "Enemy weakened (-15â€“25%)";
    if(r<=6) return "Enemy slightly weakened";
    if(r<=9) return "Even forces";
    if(r<=11) return "Enemy reinforced (+10â€“15%)";
    return "Enemy heavily reinforced (+25%)";
  }

  function section(title, body, tooltipText){
    const help = tooltipText ? `
      <span class="help" tabindex="0" aria-label="Help">?
        <span class="tip">${tooltipText}</span>
      </span>` : "";
    return `
      <div class="section">
        <div class="section-title">${title} ${help}</div>
        ${body}
      </div>
    `;
  }

  function header(){ return `<p><strong>Realm:</strong> ${state.realm}</p>`; }

  function generalBlock(){
    if(!state.general) return `<p class="muted">No general yet. Click <strong>Roll General</strong>.</p>`;
    return `
      <p><strong>General:</strong> ${state.general.name}</p>
      <p><strong>Background:</strong> ${state.general.bgLabel}</p>
      <p><strong>Mission:</strong> ${state.missionType || "â€”"}</p>
    `;
  }

  function renderCurrent(){
    document.getElementById("cur-realm").textContent = state.realm || "â€”";
    document.getElementById("cur-general").textContent = state.general?.name || "â€”";
    document.getElementById("cur-bg").textContent = state.general?.bgLabel || "â€”";
    document.getElementById("cur-mission").textContent = state.missionType || "â€”";
  }

  const out = document.getElementById("out");

  function battleHookBlock(){
    const hook = state.lastHook?.type === (state.missionType || "") ? state.lastHook : rollBattleHookForCurrentMission();
    return section(
      "Battle Hook",
      `<p><strong>${hook.type}:</strong> ${hook.text}</p>`,
      "Reroll this to get a different blurb for the same Mission type."
    );
  }

  document.getElementById("btn-all").onclick = () => {
    ensureRealm();
    if(!state.general) rollGeneral();
    if(!state.missionType) rollMission();
    rollBattleHookForCurrentMission();

    out.innerHTML =
      header() +
      generalBlock() +
      battleHookBlock() +
      section("Threat", `<p>${threat()}</p>`, "Use this to slightly adjust points if you want. Ignore it if you donâ€™t.");

    renderCurrent();
  };

  document.getElementById("btn-general").onclick = () => {
    ensureRealm();
    rollGeneral();
    out.innerHTML = header() + generalBlock();
    renderCurrent();
  };

  document.getElementById("btn-mission").onclick = () => {
    ensureRealm();
    rollMission();           // changes mission type
    rollBattleHookForCurrentMission(); // auto-roll first hook for that mission
    out.innerHTML = header() + generalBlock() + battleHookBlock();
    renderCurrent();
  };

  document.getElementById("btn-hook").onclick = () => {
    ensureRealm();
    if(!state.missionType) rollMission();
    rollBattleHookForCurrentMission(); // rerolls hook, mission stays same
    out.innerHTML = header() + generalBlock() + battleHookBlock();
    renderCurrent();
  };

  document.getElementById("btn-interlude").onclick = () => {
    ensureRealm();
    const pool = [
      ...interludes.base,
      ...(interludes[state.general?.bgKey] || [])
    ];
    out.innerHTML =
      header() + generalBlock() +
      section("Interlude", `<p>${pick(pool)}</p>`,
        "A short between-battle beat. Use it as a scene, a paragraph of diary text, or a quick roleplay moment."
      );
    renderCurrent();
  };

  document.getElementById("btn-reset").onclick = () => {
    state = {};
    clear();
    renderCurrent();
    out.innerHTML = `<p class="muted">Character reset. Click <strong>Generate Full Starter</strong> to begin.</p>`;
  };

  document.getElementById("btn-copy").onclick = async () => {
    try{ await navigator.clipboard.writeText(out.innerText || ""); alert("Copied"); }
    catch(e){ alert("Copy failed. Select the text and copy manually."); }
  };

  renderCurrent();
})();
</script>
</body>
</html>
