<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stormcast Eternals â€“ Story Mode Generator</title>

  <style>
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      margin:0;
      padding:16px;
      background:#fff;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      border:1px solid #ddd;
      border-radius:12px;
      padding:16px;
      background:#fff;
    }
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .card{
      border:1px solid #e6e6e6;
      border-radius:12px;
      padding:12px;
      background:#fafafa;
      flex:1;
      min-width:260px;
    }
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
    button{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #ccc;
      background:#f3f3f3;
      font-weight:800;
      cursor:pointer
    }
    button.primary{background:#1976d2;border-color:#1976d2;color:#fff}
    button.danger{background:#fff;border-color:#d32f2f;color:#d32f2f}

    h3{margin:0 0 6px 0}
    .muted{color:#777;font-size:12px}
    .kv{margin:0;font-size:14px;line-height:1.4}
    .kv b{display:inline-block;min-width:110px}

    /* Output */
    .output{
      margin:0;
      padding:16px;
      background:#fff;
      border-radius:12px;
      min-height:220px;
      border:1px solid #ddd;
      line-height:1.55;
    }
    .output p{margin:0 0 10px 0}
    .output strong{font-weight:700}

    /* Sections */
    .section{
      margin:14px 0 10px 0;
      padding-top:12px;
      border-top:1px solid #e9e9e9;
    }
    .section-title{
      font-size:13px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:#666;
      font-weight:800;
      margin-bottom:6px;
    }

    /* Campaign log header */
    .log-header{
      display:flex;
      align-items:center;
      gap:10px;
      margin:12px 0 6px 0;
    }
    .log-icon{
      width:34px;height:34px;
      border-radius:10px;
      border:1px solid #e1e1e1;
      background:#f7f7f7;
      display:flex;align-items:center;justify-content:center;
      font-size:18px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <h3>Stormcast Eternals â€“ Story Mode Generator</h3>
  <p class="muted">Optional narrative aide. No rules impact. Saved locally in your browser.</p>

  <div class="row" style="margin-top:12px;">
    <div class="card">
      <h3 style="font-size:16px;">Current Character</h3>
      <p class="kv"><b>Realm:</b> <span id="cur-realm">â€”</span></p>
      <p class="kv"><b>General:</b> <span id="cur-general">â€”</span></p>
      <p class="kv"><b>Background:</b> <span id="cur-bg">â€”</span></p>
      <p class="kv"><b>Complication:</b> <span id="cur-comp">â€”</span></p>
      <div class="btns">
        <button id="btn-reset" class="danger">Reset Character</button>
      </div>
    </div>

    <div class="card">
      <h3 style="font-size:16px;">Actions</h3>
      <div class="btns">
        <button id="btn-all" class="primary">Generate Full Starter</button>
        <button id="btn-general">Roll General</button>
        <button id="btn-episode">Roll Episode</button>
        <button id="btn-interlude">Roll Interlude</button>
        <button id="btn-copy">Copy</button>
      </div>
      <p class="muted">Roll a General once, then Episodes + Interludes between games.</p>
    </div>
  </div>

  <div class="log-header">
    <div class="log-icon">ðŸ“œ</div>
    <h3>Campaign Log</h3>
  </div>

  <div id="out" class="output">
    <p class="muted">Ready. Click <strong>Generate Full Starter</strong>.</p>
  </div>

</div>

<script>
(function(){

const STORAGE = "woehammer_stormcast_story_v3";
const pick = a => a[Math.floor(Math.random()*a.length)];
const roll = n => Math.floor(Math.random()*n)+1;

let state = JSON.parse(localStorage.getItem(STORAGE) || "{}");
const save = () => localStorage.setItem(STORAGE, JSON.stringify(state));

/* DATA */

const realms = ["Aqshy","Ghyran","Shyish","Ghur","Chamon","Ulgu"];

const firstNames = [
  "Aster","Lyra","Kaelis","Brannic","Seraphine","Garran",
  "Odrin","Merek","Siora","Eamon","Vexan","Thane"
];

const lastNames = [
  "Valorn","Dawnward","Stormvein","Goldsign","Halospear",
  "Ironlight","Truthbrand","Ashward","Skywrath",
  "Steelward","Windstride","Brightfall"
];

const backgrounds = [
  {k:"reforged",l:"Many-Times Reforged (Memories Fraying)"},
  {k:"new",l:"Freshly Forged (New to Immortality)"},
  {k:"redeemer",l:"Redeemer (Oath to Protect the Helpless)"},
  {k:"slayer",l:"Slayer (Hunts a Specific Foe)"},
  {k:"prophet",l:"Vision-Bound (Dreams and Portents)"},
  {k:"judge",l:"Celestial Judge (No Mercy for Corruption)"}
];

const complications = [
  "Memory loss after reforging",
  "A rival within the Stormhost",
  "A settlement sworn under protection",
  "Orders that conflict with conscience",
  "A prophecy that will not fade",
  "A flaw others must not see"
];

const episodeTypes = ["Incursion","Pursuit","Escalation","Revelation"];

const episodes = {
  Incursion:[
    "A sudden assault strikes an area thought secure. The enemy withdraws before full strength can be brought to bear.",
    "A probing attack tests defences and resolve. Someone is watching closely.",
    "Enemy forces land unexpectedly, forcing a rapid response."
  ],
  Pursuit:[
    "The enemy retreats in haste. Letting them escape will cost you later.",
    "Rear-guards fight viciously, buying time with blood."
  ],
  Escalation:[
    "The conflict widens. Reinforcements arrive and restraint vanishes.",
    "What began quietly is now open war."
  ],
  Revelation:[
    "You learn the enemy was never acting alone.",
    "Victory uncovers a truth you wish you had not found."
  ]
};

const interludes = {
  base:[
    "Mortals look to you as a myth made real â€” and expect miracles.",
    "Orders from Azyr conflict with reality on the ground.",
    "A memory surfaces that should not exist."
  ],
  reforged:[
    "You forget a name that once mattered more than victory."
  ],
  new:[
    "Immortality settles in â€” heavier than expected."
  ],
  redeemer:[
    "Protecting the innocent may cost momentum."
  ],
  slayer:[
    "Signs suggest your quarry is close â€” and you feel reckless."
  ],
  judge:[
    "Corruption is found among allies. Justice will fracture trust."
  ]
};

/* FUNCTIONS */

function ensureRealm(){
  if(!state.realm){ state.realm = pick(realms); save(); }
}

function rollGeneral(){
  const bg = pick(backgrounds);
  state.general = {
    name: `${pick(firstNames)} ${pick(lastNames)}`,
    bgKey: bg.k,
    bgLabel: bg.l,
    comp: pick(complications)
  };
  save();
}

function threat(){
  const r = roll(6)+roll(6);
  if(r<=3) return "Enemy weakened (-15â€“25%)";
  if(r<=6) return "Enemy slightly weakened";
  if(r<=9) return "Even forces";
  if(r<=11) return "Enemy reinforced (+10â€“15%)";
  return "Enemy heavily reinforced (+25%)";
}

/* OUTPUT BUILDERS */

function header(){
  return `<p><strong>Realm:</strong> ${state.realm}</p>`;
}

function generalBlock(){
  if(!state.general) return `<p class="muted">No general yet.</p>`;
  return `
    <p><strong>General:</strong> ${state.general.name}</p>
    <p><strong>Background:</strong> ${state.general.bgLabel}</p>
    <p><strong>Complication:</strong> ${state.general.comp}</p>
  `;
}

function section(title, body){
  return `
    <div class="section">
      <div class="section-title">${title}</div>
      ${body}
    </div>
  `;
}

/* BUTTONS */

const out = document.getElementById("out");

document.getElementById("btn-all").onclick = () => {
  ensureRealm();
  if(!state.general) rollGeneral();
  const type = pick(episodeTypes);
  out.innerHTML =
    header() +
    generalBlock() +
    section("Episode", `<p><strong>${type}:</strong> ${pick(episodes[type])}</p>`) +
    section("Threat", `<p>${threat()}</p>`);
};

document.getElementById("btn-general").onclick = () => {
  ensureRealm(); rollGeneral();
  out.innerHTML = header()+generalBlock();
};

document.getElementById("btn-episode").onclick = () => {
  ensureRealm();
  const type = pick(episodeTypes);
  out.innerHTML =
    header()+generalBlock()+
    section("Episode", `<p><strong>${type}:</strong> ${pick(episodes[type])}</p>`);
};

document.getElementById("btn-interlude").onclick = () => {
  ensureRealm();
  const pool = [
    ...interludes.base,
    ...(interludes[state.general?.bgKey]||[])
  ];
  out.innerHTML =
    header()+generalBlock()+
    section("Interlude", `<p>${pick(pool)}</p>`);
};

document.getElementById("btn-reset").onclick = () => {
  state={}; save();
  out.innerHTML = `<p class="muted">Character reset.</p>`;
};

document.getElementById("btn-copy").onclick = async () => {
  await navigator.clipboard.writeText(out.innerText);
  alert("Copied");
};

})();
</script>
</body>
</html>
