<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stormcast Eternals â€“ Story Mode Generator</title>

  <style>
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      margin:0;
      padding:16px;
      background:#fff;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      border:1px solid #ddd;
      border-radius:12px;
      padding:16px;
      background:#fff;
    }
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .card{
      border:1px solid #e6e6e6;
      border-radius:12px;
      padding:12px;
      background:#fafafa;
      flex:1;
      min-width:260px;
    }
    .btns{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
    button{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #ccc;
      background:#f3f3f3;
      font-weight:800;
      cursor:pointer
    }
    button.primary{background:#1976d2;border-color:#1976d2;color:#fff}
    button.danger{background:#fff;border-color:#d32f2f;color:#d32f2f}

    h3{margin:0 0 6px 0}
    .muted{color:#777;font-size:12px}
    .kv{margin:0;font-size:14px;line-height:1.4}
    .kv b{display:inline-block;min-width:110px}

    /* Output */
    .output{
      margin:0;
      padding:16px;
      background:#fff;
      border-radius:12px;
      min-height:220px;
      border:1px solid #ddd;
      line-height:1.55;
    }
    .output p{margin:0 0 10px 0}
    .output strong{font-weight:700}

    /* Sections */
    .section{
      margin:14px 0 10px 0;
      padding-top:12px;
      border-top:1px solid #e9e9e9;
    }
    .section-title{
      font-size:13px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:#666;
      font-weight:800;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    /* Campaign log header */
    .log-header{
      display:flex;
      align-items:center;
      gap:10px;
      margin:12px 0 6px 0;
    }
    .log-icon{
      width:34px;height:34px;
      border-radius:10px;
      border:1px solid #e1e1e1;
      background:#f7f7f7;
      display:flex;align-items:center;justify-content:center;
      font-size:18px;
    }

    /* Tooltip */
    .help{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:18px;height:18px;
      border-radius:999px;
      border:1px solid #d0d0d0;
      background:#f7f7f7;
      color:#555;
      font-weight:900;
      font-size:12px;
      line-height:1;
      cursor:help;
      position:relative;
      user-select:none;
      flex:0 0 auto;
    }
    .help:focus{ outline:2px solid #1976d2; outline-offset:2px; }

    .help .tip{
      display:none;
      position:absolute;
      z-index:50;
      left:50%;
      transform:translateX(-50%);
      top:24px;
      width:min(280px, 75vw);
      background:#111;
      color:#fff;
      border-radius:10px;
      padding:10px 12px;
      font-size:12px;
      font-weight:600;
      box-shadow:0 8px 20px rgba(0,0,0,.2);
    }
    .help .tip::before{
      content:"";
      position:absolute;
      top:-6px;
      left:50%;
      transform:translateX(-50%);
      border-width:0 6px 6px 6px;
      border-style:solid;
      border-color:transparent transparent #111 transparent;
    }

    /* Show tooltip on hover AND tap/focus */
    .help:hover .tip,
    .help:focus .tip{
      display:block;
    }
  </style>
</head>

<body>
<div class="wrap" id="storymode-stormcast">

  <h3>Stormcast Eternals â€“ Story Mode Generator</h3>
  <p class="muted">Optional narrative aide. No rules impact. Saved locally in your browser.</p>

  <div class="row" style="margin-top:12px;">
    <div class="card">
      <h3 style="font-size:16px;">Current Character</h3>

      <p class="kv"><b>Realm:</b> <span id="cur-realm">â€”</span></p>

      <p class="kv"><b>General:</b> <span id="cur-general">â€”</span></p>

      <p class="kv">
        <b>Background:</b> <span id="cur-bg">â€”</span>
      </p>

      <p class="kv">
        <b>Mission:</b> <span id="cur-mission">â€”</span>
        <span class="help" tabindex="0" aria-label="What is Mission?">?
          <span class="tip">Your <b>Mission</b> is the reason your force is fighting right now â€” a personal goal or duty. It doesnâ€™t change rules; it gives context.</span>
        </span>
      </p>

      <div class="btns">
        <button id="btn-reset" class="danger" type="button">Reset Character</button>
      </div>
    </div>

    <div class="card">
      <h3 style="font-size:16px;">Actions</h3>
      <div class="btns">
        <button id="btn-all" class="primary" type="button">Generate Full Starter</button>
        <button id="btn-general" type="button">Roll General</button>
        <button id="btn-battle" type="button">Roll Battle Hook</button>
        <button id="btn-interlude" type="button">Roll Interlude</button>
        <button id="btn-copy" type="button">Copy</button>
      </div>
      <p class="muted">Roll a General once, then Battle Hooks + Interludes between games.</p>
    </div>
  </div>

  <div class="log-header">
    <div class="log-icon">ðŸ“œ</div>
    <h3>Campaign Log</h3>
  </div>

  <div id="out" class="output">
    <p class="muted">Ready. Click <strong>Generate Full Starter</strong>.</p>
  </div>

</div>

<script>
(function(){
  const STORAGE = "woehammer_stormcast_story_v5";
  const pick = a => a[Math.floor(Math.random()*a.length)];
  const roll = n => Math.floor(Math.random()*n)+1;

  let state = {};
  try { state = JSON.parse(localStorage.getItem(STORAGE) || "{}"); }
  catch { state = {}; }

  const save = () => localStorage.setItem(STORAGE, JSON.stringify(state));
  const clear = () => localStorage.removeItem(STORAGE);

  const realms = ["Aqshy","Ghyran","Shyish","Ghur","Chamon","Ulgu"];

  const firstNames = ["Aster","Lyra","Kaelis","Brannic","Seraphine","Garran","Odrin","Merek","Siora","Eamon","Vexan","Thane"];
  const lastNames  = ["Valorn","Dawnward","Stormvein","Goldsign","Halospear","Ironlight","Truthbrand","Ashward","Skywrath","Steelward","Windstride","Brightfall"];

  const backgrounds = [
    {k:"reforged",l:"Many-Times Reforged (Memories Fraying)"},
    {k:"new",l:"Freshly Forged (New to Immortality)"},
    {k:"redeemer",l:"Redeemer (Oath to Protect the Helpless)"},
    {k:"slayer",l:"Slayer (Hunts a Specific Foe)"},
    {k:"prophet",l:"Vision-Bound (Dreams and Portents)"},
    {k:"judge",l:"Celestial Judge (No Mercy for Corruption)"}
  ];

  const missions = [
    "Protect a vulnerable settlement",
    "Recover a sacred relic before the enemy does",
    "Hunt down a particular foe",
    "Hold the line until reinforcements arrive",
    "Break the enemyâ€™s supply route",
    "Answer a prophecy or omen you cannot ignore"
  ];

  const types = ["Incursion","Pursuit","Escalation","Revelation"];

  const battleHooks = {
    Incursion:[
      "A sudden assault strikes an area thought secure. The enemy withdraws before full strength can be brought to bear.",
      "A probing attack tests defences and resolve. Someone is watching closely.",
      "Enemy forces arrive unexpectedly, forcing a rapid response."
    ],
    Pursuit:[
      "The enemy retreats in haste. Letting them escape will cost you later.",
      "Rear-guards fight viciously, buying time with blood."
    ],
    Escalation:[
      "The conflict widens. Reinforcements arrive and restraint vanishes.",
      "What began quietly is now open war."
    ],
    Revelation:[
      "You learn the enemy was never acting alone.",
      "Victory uncovers a truth you wish you had not found."
    ]
  };

  const interludes = {
    base:[
      "Mortals look to you as a myth made real â€” and expect miracles.",
      "Orders from Azyr conflict with reality on the ground.",
      "A memory surfaces that should not exist."
    ],
    reforged:["You forget a name that once mattered more than victory."],
    new:["Immortality settles in â€” heavier than expected."],
    redeemer:["A plea for protection arrives at the worst possible moment."],
    slayer:["You glimpse a sign that your quarry is close â€” and it makes you reckless."],
    judge:["Corruption is found among allies. Justice will fracture trust."],
    prophet:["A dream leaves you certain of the next battlefieldâ€¦ and afraid of it."]
  };

  function ensureRealm(){
    if(!state.realm){ state.realm = pick(realms); save(); }
  }

  function rollGeneral(){
    const bg = pick(backgrounds);
    state.general = {
      name: `${pick(firstNames)} ${pick(lastNames)}`,
      bgKey: bg.k,
      bgLabel: bg.l,
      mission: pick(missions)
    };
    save();
  }

  function threat(){
    const r = roll(6)+roll(6);
    if(r<=3) return "Enemy weakened (-15â€“25%)";
    if(r<=6) return "Enemy slightly weakened";
    if(r<=9) return "Even forces";
    if(r<=11) return "Enemy reinforced (+10â€“15%)";
    return "Enemy heavily reinforced (+25%)";
  }

  function section(title, body, tooltipText){
    const help = tooltipText ? `
      <span class="help" tabindex="0" aria-label="Help">?
        <span class="tip">${tooltipText}</span>
      </span>` : "";
    return `
      <div class="section">
        <div class="section-title">${title} ${help}</div>
        ${body}
      </div>
    `;
  }

  function header(){
    return `<p><strong>Realm:</strong> ${state.realm}</p>`;
  }

  function generalBlock(){
    if(!state.general) return `<p class="muted">No general yet. Click <strong>Roll General</strong>.</p>`;
    return `
      <p><strong>General:</strong> ${state.general.name}</p>
      <p><strong>Background:</strong> ${state.general.bgLabel}</p>
      <p><strong>Mission:</strong> ${state.general.mission}</p>
    `;
  }

  function renderCurrent(){
    document.getElementById("cur-realm").textContent = state.realm || "â€”";
    document.getElementById("cur-general").textContent = state.general?.name || "â€”";
    document.getElementById("cur-bg").textContent = state.general?.bgLabel || "â€”";
    document.getElementById("cur-mission").textContent = state.general?.mission || "â€”";
  }

  const out = document.getElementById("out");

  document.getElementById("btn-all").onclick = () => {
    ensureRealm();
    if(!state.general) rollGeneral();

    const type = pick(types);
    out.innerHTML =
      header() +
      generalBlock() +
      section(
        "Battle Hook",
        `<p><strong>${type}:</strong> ${pick(battleHooks[type])}</p>`,
        "A <b>Battle Hook</b> is a short story prompt for why the next game is happening. Itâ€™s not a scenario â€” just narrative context."
      ) +
      section("Threat", `<p>${threat()}</p>`, "Use this to slightly adjust points if you want. Ignore it if you donâ€™t.");

    renderCurrent();
  };

  document.getElementById("btn-general").onclick = () => {
    ensureRealm();
    rollGeneral();
    out.innerHTML = header() + generalBlock();
    renderCurrent();
  };

  document.getElementById("btn-battle").onclick = () => {
    ensureRealm();
    const type = pick(types);
    out.innerHTML =
      header() + generalBlock() +
      section(
        "Battle Hook",
        `<p><strong>${type}:</strong> ${pick(battleHooks[type])}</p>`,
        "A <b>Battle Hook</b> is a story prompt for why the next game is happening. Not a forced mission."
      );
    renderCurrent();
  };

  document.getElementById("btn-interlude").onclick = () => {
    ensureRealm();
    const pool = [
      ...interludes.base,
      ...(interludes[state.general?.bgKey] || [])
    ];
    out.innerHTML =
      header() + generalBlock() +
      section("Interlude", `<p>${pick(pool)}</p>`, "A short between-battle beat. Use it as a scene, a paragraph of diary text, or a quick roleplay moment.");
    renderCurrent();
  };

  document.getElementById("btn-reset").onclick = () => {
    state = {};
    clear();
    renderCurrent();
    out.innerHTML = `<p class="muted">Character reset. Click <strong>Generate Full Starter</strong> to begin.</p>`;
  };

  document.getElementById("btn-copy").onclick = async () => {
    try{
      await navigator.clipboard.writeText(out.innerText || "");
      alert("Copied");
    }catch(e){
      alert("Copy failed. Select the text and copy manually.");
    }
  };

  renderCurrent();
})();
</script>
</body>
</html>
